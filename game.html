<!DOCTYPE html>

<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <meta name="author" content="Ishaku Yusuf Maina">
  <!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
  <script src="element.js"></script>
<!-- Latest compiled JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="tictacto.js"></script>
</head>
<body class="container">
  <h1 class="small">Three Center</h1>
  <div id="root">
    
  </div>
  <footer><small>Â©2022 I. Y Maina</small></footer>
  <script>
let str ="637";
  class FiveMatch extends TicTacToe {
    constructor(){
      super();
      this.hands = [5, 5];
     this.maxSeed=5;
     this.winningPositions = ["1.2.3.4.5", "6.7.8.9.10", "11.12.13.14.15", "16.17.18.19.20", "21.22.23.24.25", "1.6.11.16.21", "2.7.12.17.22", "3.8.13.18.23", "4.9.14.19.24", "5.10.15.20.25",
      "1.7.13.19.25", "5.9.13.17.21",
      "2.7.9.11.15", "11.15.17.19.23", "1.7.13.17.21", "1.7.13.9.5", "5.9.13.19.25"];
      this.moves = [[0, 0, 0, 0, 0], [0,0,0,0,0]];
     this.legalMoves = [12, 16, 17, 21, 23, 27, 32, 34, 37, 38, 39,
    43, 45, 49, 54, 59, 510, 61, 67, 611, 71, 72, 73, 76, 78, 711, 712, 713, 82, 87, 89, 94, 95, 98, 910, 913, 914, 915, 105, 109, 1015, 116, 117, 1112, 1116, 1117, 127, 1211, 1213, 1217,
      137, 138, 139, 1312, 1314, 1317, 1318, 1319, 149, 1413, 1415, 1415, 1418, 1419,
      159,1510, 1514, 1519, 1520, 1611, 1617, 1621, 1711, 1712, 1713, 1716, 1718, 1721, 1722, 1723,
      1830, 1817, 1819, 1823,
      1913, 1914, 1915, 1920, 1923, 1924, 1925,
      2015, 2019, 2025,
      2116, 2117, 2122,
      2217, 2221, 2223,
      2317, 2318, 2319, 2322, 2324,
      2419, 2423, 2425,
      2519, 2520, 2524];
    }
  }
  class FiveMatchView extends TicTacToeView{
    constructor(){
      super();
      this.no_cells = 25;
      this.inflate();
      this.boardId = "board25";
    }
  }
  
  let ttt = new TicTacToe();
 let tttView = new TicTacToeView();
 let tttCtr = new TicTacToeCtr(ttt,tttView); 
  root.appendChild(tttCtr.getView());
  //tttView.showWinner(1);
var clickRemoteCell;
  </script>
  <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-analytics.js";
  import { getDatabase, ref, get, set, onValue} from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyBDNM9mFeym26je4OsKeyBlYa4yCFH--oA",
    authDomain: "remote3center.firebaseapp.com",
    databaseURL: "https://remote3center-default-rtdb.firebaseio.com",
    projectId: "remote3center",
    storageBucket: "remote3center.appspot.com",
    messagingSenderId: "1096620244256",
    appId: "1:1096620244256:web:47c39dc1350eb61395eb45",
    measurementId: "G-SVMSVQNZPQ"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
const db = getDatabase(app);


    let player = localStorage.getItem("player");
    let id = localStorage.getItem("id");
    let pcode = localStorage.getItem("pcode");

    clickRemoteCell=(cellId)=>{
      let remoteP = (player=="1st")? "p2" : "p1";
      set(ref(db, "games/"+id+"/"+remoteP), {btnId: cellId });
      
    }

        if (player == "1st"){
      alert("pls wait for a joiner");
      /*onValue (ref(db, "games/"+id), (snapshot)=>{
        let value = snapshot.val();
        if (value.joined){
          alert("a gamer has successfully joined as player 2");
          */
          onValue(ref(db, "games/"+id+"/p2"), (snapshot)=>{
            let value = snapshot.val();
            if (!value){
              alert("a gamer has successfully joined as player 2");
              return;
            }
            let btnId = value.btnId;
            let btn = document.getElementById(btnId);
            btn.click();
            alert (btnId);
          });
        //}
      //});
    } else if (player=="2nd"){
      //alert("you have successfully joined as second player");
      onValue(ref(db, "games/"+id+"/p1"), (snapshot)=>{
        let value= snapshot.val();
        if (!value){
          alert("you have successfully joined as player 2");
          return;
        }
        let btnId = value.btnId;
        let btn = document.getElementById(btnId);
        btn.click();
        alert(btnId);
      });
    } else {
      alert("error encountered");
    }
  </script>
</body>
</html>
