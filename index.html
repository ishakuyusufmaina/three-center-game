<!DOCTYPE html>

<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <meta name="author" content="Ishaku Yusuf Maina">
  <!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="sty l e.css" rel="stylesheet">
  <script src="element.js"></script>
<!-- Latest compiled JavaScript -->
  <script src="model.js" ></script>
</head>
<body class="container">
  <h1 class="small">Say Center</h1>
  <div id="root">
    <div id="boardContainer"></div>
    <div id="status"></div>
    <input id="inp" placeholder="player">
    
  </div>
  <!--footer><small>Â©2022 I. Y Maina</small></footer-->
  <style>
  #boardContainer {
   width: 100%; /* Set a fixed width */
  height: 400px; /* Set a fixed height */
  overflow: auto; /* Enable scrolling for both axes (x and y) */
  border: 2px solid #ccc;
  padding: 10px;
  background-color: #f9f9f9;
  }
  </style>
  <script> 
 var board = new Model(3);
var mode= "remote";
 // alert(board.currentPlayer.seed)
 const boardElm = createBoard(board);
  const status = document.getElementById("status"); //.appendChild(updateStatus(board));
 // root1.appendChild(boardElm);
  animate();
  </script>



<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-analytics.js";
  import { getDatabase, ref, get, set, child, onValue} from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyBDNM9mFeym26je4OsKeyBlYa4yCFH--oA",
    authDomain: "remote3center.firebaseapp.com",
    databaseURL: "https://remote3center-default-rtdb.firebaseio.com",
    projectId: "remote3center",
    storageBucket: "remote3center.appspot.com",
    messagingSenderId: "1096620244256",
    appId: "1:1096620244256:web:47c39dc1350eb61395eb45",
    measurementId: "G-SVMSVQNZPQ"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
const db = getDatabase(app);



onValue(ref(db, "games/test11"), (snapshot)=>{
let value = snapshot.val();
   if (value){
console.log(value.board);
board.fromRemote(value.board);

}  });

remotePlay = (board)=> {
set(ref(db, "games/test11"), {
board: board.toRemote() });
}

/*
      createBtn.onclick = ()=>{
        alert ("trying to create. pls wait..");
        let id = gameId.value;
        let pcode= passcode.value;
        if (id.length==0 | pcode.length==0){
          return}
        let dbRef = ref(db);
        get(child(dbRef, "games/"+id)).then((snapshot)=>{
          if (snapshot.exists()){
            alert("game with " + id +" already exists. Change another id");
          } else {
            set(ref(db, "games/"+id), {
              passcode: pcode,
              joined: false
            }).then(()=>{
              alert("game created successfully");
              localStorage.setItem("player", "1st");
              localStorage.setItem("id", id);
              localStorage.setItem("pcode", pcode);
              window.location.assign("wait.html");
            }).catch((e)=>{
              alert(e);
            });
          }
        }).catch((e)=>{
          alert(e);
        });

      }
        

      joinBtn.onclick = ()=>{
        alert("pls wait while joining");
        let id = gameId.value;
        let pcode = gamePasscode.value;
        if (id.length ==0 | pcode.length ==0){
          return; 
        }

        let dbRef = ref(db);
        get(child(dbRef, "games/"+id)).then((snapshot)=>{
          if (snapshot.exists()){
            let value = snapshot.val();
            if (value.passcode == pcode){
              if (value.joined){
                alert("game is engaged already!");
              } else {
                set(ref(db, "games/"+id), {
                  passcode: pcode,
                  joined: true
                }).then(()=>{
                  alert("successfully joined");
                  localStorage.setItem("player", "2nd");
                  localStorage.setItem("id", id);
                  localStorage.setItem("pcode", pcode);
                  window.location.assign("....html");
      
                }).catch((e)=>{
                  alert(e);
                });
              }
            } else {
              alert("wrong passcode pls!");
            }
          } else {
            alert("game not existing");
          }
        });
      } */
</script>
</body>
</html>
