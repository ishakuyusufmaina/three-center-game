<!DOCTYPE html>

<html>
<head>
  <meta http-equiv="CONTENT-TYPE" content="text/html; charset=UTF-8">
  <title>Three Center Home</title>
</head>
<body>
  <h1>
    
  </h1>  
  <div id="join_create_game">
    <h2>Join/create 3C game</h2>
    <input placeholder="game id" id="gameId"><br>
    <input placeholder="passcode" id="gamePasscode"><br>
    <button id="joinBtn">Join</button>
    <button id="createBtn">Create</button>



    <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-analytics.js";
  import { getDatabase, ref, get, set, child } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyBDNM9mFeym26je4OsKeyBlYa4yCFH--oA",
    authDomain: "remote3center.firebaseapp.com",
    databaseURL: "https://remote3center-default-rtdb.firebaseio.com",
    projectId: "remote3center",
    storageBucket: "remote3center.appspot.com",
    messagingSenderId: "1096620244256",
    appId: "1:1096620244256:web:47c39dc1350eb61395eb45",
    measurementId: "G-SVMSVQNZPQ"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
const db = getDatabase(app);


      createBtn.onclick = ()=>{
        alert ("trying to create. pls wait..");
        let id = gameId.value;
        let pcode= gamePasscode.value;
        if (id.length==0 | pcode.length==0){
          return}
        let dbRef = ref(db);
        get(child(dbRef, "games/"+id)).then((snapshot)=>{
          if (snapshot.exists()){
            alert("game with " + id +" already exists. Change another id");
          } else {
            set(ref(db, "games/"+id), {
              passcode: pcode,
              joined: false
            }).then(()=>{
              alert("game created successfully");
              localStorage.setItem("player", "1st");
              localStorage.setItem("id", id);
              localStorage.setItem("pcode", pcode);
              window.location.assign("https://www.ishakuyusufmaina.github.io/three-center-game/game");
            }).catch((e)=>{
              alert(e);
            });
          }
        }).catch((e)=>{
          alert(e);
        });

      }
        

      joinBtn.onclick = ()=>{
        alert("pls wait while joining");
        let id = gameId.value;
        let pcode = gamePasscode.value;
        if (id.length ==0 | pcode.length ==0){
          return; 
        }

        let dbRef = ref(db);
        get(child(dbRef, "games/"+id)).then((snapshot)=>{
          if (snapshot.exists()){
            let value = snapshot.val();
            if (value.passcode == pcode){
              if (value.joined){
                alert("game is engaged already!");
              } else {
                set(ref(db, "games/"+id), {
                  passcode: pcode,
                  joined: true
                }).then(()=>{
                  alert("successfully joined");
                  localStorage.setItem("player", "2nd");
                  localStorage.setItem("id", id);
                  localStorage.setItem("pcode", pcode);
                  window.location.assign("https://www.ishakuyusufmaina.github.io/three-center-game/game");
      
                }).catch((e)=>{
                  alert(e);
                });
              }
            } else {
              alert("wrong passcode pls!");
            }
          } else {
            alert("game not existing");
          }
        });
      }
</script>
</body>
</html>
